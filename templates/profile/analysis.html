{% extends 'base.html' %}

{% block title %}Аналитика{% endblock %}

{% block content %}
<h1 class="welcome-title">Аналитика</h1>
<hr style="margin-bottom: 20px;">

<form method="get" class="date-filter-form">
  <div class="date-range-container">
    <div class="filter-group">
      <label for="date_from">Дата с:</label>
      <input type="date" id="date_from" name="date_from" value="{{ date_from }}">
    </div>

    <div class="filter-group">
      <label for="date_to">Дата по:</label>
      <input type="date" id="date_to" name="date_to" value="{{ date_to }}">
    </div>

    <div class="filter-group">
      <label for="emotion">Эмоция:</label>
      <select id="emotion" name="emotion">
        <option value="all" {% if emotion_filter == "all" or not emotion_filter %}selected{% endif %}>Все</option>
        {% for emotion in emotion_options %}
        <option value="{{ emotion }}" {% if emotion_filter == emotion %}selected{% endif %}>{{ emotion }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="buttons-container">
    <button type="submit" class="btn-apply">Применить</button>
    <button type="button" class="btn-reset" onclick="resetFilter()">Сбросить</button>
  </div>
</form>



{% if error %}
<p style="color: red;">{{ error }}</p>
{% else %}
{% if avg_age %}
<p>Средний возраст по фото: {{ avg_age }}</p>
{% endif %}
<p>Реальный возраст: {{ user_age }}</p>

<div style="display: flex; flex-direction: column; align-items: center; gap: 30px;">
    <div style="text-align: center;">
        <h3>Возраст</h3>
        <img class="chart-image" src="data:image/png;base64,{{ graphic1 }}" alt="Анализ возраста">
    </div>
    <div style="text-align: center;">
        <h3>Эмоции</h3>
        <img class="chart-image" src="data:image/png;base64,{{ graphic2 }}" alt="Анализ эмоций">
    </div>
</div>
{% endif %}

<!-- Модальное окно -->
<div id="imageModal" class="modal" onclick="hideImageModal()">
    <span class="close" onclick="hideImageModal(event)">&times;</span>
    <img class="modal-fullscreen" id="modalImage" style="max-width: 90%; max-height: 90%;">
</div>

<script>
    document.querySelectorAll('.chart-image').forEach(img => {
        img.addEventListener('click', function () {
            const modal = document.getElementById("imageModal");
            const modalImg = document.getElementById("modalImage");
            modalImg.src = this.src;
            modal.style.display = "flex";
        });
    });

    function hideImageModal(event) {
        const modal = document.getElementById("imageModal");
        if (!event || event.target.classList.contains('modal') || event.target.classList.contains('close')) {
            modal.style.display = "none";
        }
    }

    function resetFilter() {
        document.getElementById('date_from').value = '';
        document.getElementById('date_to').value = '';
        // Отправляем форму с пустыми полями
        document.querySelector('.date-filter-form').submit();
    }

    function resetFilter() {
        document.getElementById('date_from').value = '';
        document.getElementById('date_to').value = '';
        document.getElementById('emotion').value = 'all';
        document.querySelector('.date-filter-form').submit();
    }
</script>

{% endblock %}
