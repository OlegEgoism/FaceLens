{% extends 'base.html' %}

{% block title %}–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏{% endblock %}

{% block content %}
<h1 class="welcome-title">–§–æ—Ç–æ –∞–ª—å–±–æ–º</h1>
<hr style="margin-bottom: 20px;">


<!-- –°–ø–∏—Å–æ–∫ —Ñ–æ—Ç–æ -->
{% if page_obj %}
{% for photo in page_obj %}
<div class="photo-block" style="margin-bottom: 30px;">
    <img src="{{ photo.image.url }}" alt="–§–æ—Ç–æ" class="zoomable-image"
         style="max-width: 200px; border-radius: 10px; cursor: pointer;"
         onclick="showImageModal('{{ photo.image.url }}')">

    <p><strong>–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏:</strong> {{ photo.created|date:"d.m.Y H:i" }}</p>

    {% if photo.analysis %}
    <p><strong>–û—Ü–µ–Ω–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞:</strong> {{ photo.analysis.estimated_age }}</p>
    <p><strong>–û—Ü–µ–Ω–∫–∞ –∫–æ–∂–∏:</strong> {{ photo.analysis.skin_health_score }}</p>
    <p><strong>–û—Ü–µ–Ω–∫–∞ –º–æ—Ä—â–∏–Ω:</strong> {{ photo.analysis.wrinkles_score }}</p>
    <p><strong>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:</strong> {{ photo.analysis.mood }}</p>
    <p><strong>–≠–º–æ—Ü–∏—è:</strong> {{ photo.analysis.emotion_detected }}</p>
    {% else %}
    <p><em>–ê–Ω–∞–ª–∏–∑ –Ω–µ –ø—Ä–æ–≤–µ–¥—ë–Ω.</em></p>
    {% endif %}


    <form method="post" action="{% url 'analyze_photo' photo.id %}" style="margin-top: 10px;">
        {% csrf_token %}
        <button type="submit" class="button">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ</button>
    </form>

</div>
{% endfor %}
{% else %}
<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.</p>
{% endif %}





<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
<div class="pagination" style="margin-top: 20px;">
    <ul style="display: flex; gap: 5px; list-style: none; padding: 0;">
        {% if page_obj.has_previous %}
        <li><a href="?page=1&per_page={{ per_page }}">¬´ –ø–µ—Ä–≤–∞—è</a></li>
        <li><a href="?page={{ page_obj.previous_page_number }}&per_page={{ per_page }}">‚Äπ</a></li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
        {% if num == page_obj.number %}
        <li><span style="padding: 5px 10px; background: #007bff; color: white; border-radius: 4px;">{{ num }}</span></li>
        {% elif num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
        <li><a href="?page={{ num }}&per_page={{ per_page }}" style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 4px;">{{ num }}</a></li>
        {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <li><a href="?page={{ page_obj.next_page_number }}&per_page={{ per_page }}">‚Ä∫</a></li>
        <li><a href="?page={{ page_obj.paginator.num_pages }}&per_page={{ per_page }}">–ø–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a></li>
        {% endif %}
    </ul>
</div>
<br>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–æ—Ç–æ -->
<div id="imageModal" class="modal" onclick="hideImageModal()">
    <span class="close" onclick="hideImageModal(event)">&times;</span>
    <img class="modal-content" id="modalImage">
</div>


<!-- –°–∫—Ä–∏–ø—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
<script>
    function showImageModal(src) {
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        modalImg.src = src;
        modal.style.display = "block";
    }

    function hideImageModal(event) {
        const modal = document.getElementById("imageModal");
        if (!event || event.target.classList.contains('modal') || event.target.classList.contains('close')) {
            modal.style.display = "none";
        }
    }
</script>

{% endblock %}
